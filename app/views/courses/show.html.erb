<script type='text/javascript'>
  window.isSignedUpForCourse = <%= policy(@course).show? %>
</script>

<%= javascript_include_tag "course" %>

<!-- wip -->
<% if current_user.is_signed_up_for?(@course) %>
  <a href="<%= course_course_signup_path(@course, id: @course.id) %>" role="button" data-method="delete" class="btn btn-danger">Leave</a>
<% else %>
  <%= form_for [@course, @course_role], url: course_course_signups_path(@course), role: 'form', role: 'form' do |f| %>
    <%= f.submit "Sign up", class: "btn btn-primary" %>
  <% end %>
<% end %>
<!-- /wip -->

<div class="admin-panel">
  <div class="btn-group">
    <% if policy(@lesson).create? %>
      <a href="<%= new_course_lesson_path(@course) %>" role="button" class="btn btn-primary"><span class="glyphicon glyphicon-plus"></span> Add new lesson</a>
    <% end %>
    <% if policy(@assignment).create? %>
      <a href="<%= new_course_assignment_path(@course) %>" role="button" class="btn btn-primary"><span class="glyphicon glyphicon-plus"></span> Add new assignment</a>
    <% end %>

    <% if policy(@quiz).create? %>
      <a href="<%= new_course_quiz_path(@course) %>" role="button" class="btn btn-primary"><span class="glyphicon glyphicon-plus"></span> Add new quiz</a>
    <% end %>

    <% if policy(@course).update? %>
      <a href="<%= edit_course_path(@course) %>" role="button" class="btn btn-warning"><span class="glyphicon glyphicon-edit"></span> Edit course</a>
    <% end %>

    <% if policy(@course).destroy? %>
      <a href="<%= course_path(@course) %>" role="button" data-confirm="Are you sure? THIS IS IRREVERSIBLE" data-method="delete" class="btn btn-danger"><span class="glyphicon glyphicon-minus"></span> Destroy course</a>
    <% end %>
  </div>
</div>

<%= link_to '&times;'.html_safe, courses_path, role: "button", class: "close", "aria-hidden" => "true" %>
<h1><%= @course.name %></h1>

<% if current_user.logged_in? %>

  <% if policy(@course).show? %>
    <button id="show_description" class="btn btn-primary">View details</button>
  <% end %>

  <span id="course_description">
    <%= render_markdown(@course.description) %>
  </span>
<% else %>
  <%= render_markdown(@course.description) %>
<% end %>

<% if policy(@course).show? %>

<h2>Lessons</h2>

<div class="course-list">
<% @lessons.each do |lesson| %>
  <div class="media">
    <a class="pull-left" href="<%= course_lesson_path(@course, lesson) %>">
      <img class="media-object" src="<%= lesson.screenshot_url %>" alt="<%= lesson.name %>">
    </a>
    <div class="media-body">
      <h4 class="media-heading"><%= link_to lesson.name, course_lesson_path(@course, lesson) %></h4>
      <%= render_markdown(lesson.description) %>
      <button type="button" class="btn btn-link pull-right">
      <%= link_to content_tag(:span, ''), course_lesson_path(@course, lesson), class: "glyphicon glyphicon-trash", method: :delete %>
    </div>
  </div>
<% end %>

<h2>Assignments</h2>

<% @assignments.each do |assignment| %>
  <div class="media">
    <a class="pull-left" href="<%= course_lesson_path(@course, assignment) %>">
      <img class="media-object" src="<%= assignment.screenshot_url %>" alt="<%= assignment.name %>">
    </a>
    <div class="media-body">
      <h4 class="media-heading"><%= link_to assignment.name, course_assignment_path(@course, assignment) %></h4>
      <%= render_markdown(assignment.description) %>
    </div>
  </div>
<% end %>

<h2>Quizzes</h2>

<% @quizzes.each do |quiz| %>
  <div class="media">
    <a class="pull-left" href="<%= course_quiz_path(@course, quiz) %>">
      <img class="media-object" src="<%= quiz.screenshot_url %>" alt="<%= quiz.name %>">
    </a>
    <div class="media-body">
      <h4 class="media-heading"><%= link_to quiz.name, course_quiz_path(@course, quiz) %></h4>
      <%= render_markdown(quiz.description) %>
    </div>
  </div>
<% end %>

</div>

<% end %>
